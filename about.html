<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>HomeFX Trail Effect</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000000; /* fundo preto */
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #p5-holder {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="p5-holder"></div>

  <script>
    new p5((p) => {

      const fileNames = [
        "https://ik.imagekit.io/q3d43lw6h/about/26.png",
        "https://ik.imagekit.io/q3d43lw6h/about/19.png",
        "https://ik.imagekit.io/q3d43lw6h/new%20pics/2.webp",
        "https://ik.imagekit.io/q3d43lw6h/about/16.png",
        "https://ik.imagekit.io/q3d43lw6h/about/05.png",
        "https://ik.imagekit.io/q3d43lw6h/about/05.png",
        "https://ik.imagekit.io/q3d43lw6h/about/23.png",
        "https://ik.imagekit.io/q3d43lw6h/about/13.png",
        "https://ik.imagekit.io/q3d43lw6h/about/12.png",
        "https://ik.imagekit.io/q3d43lw6h/about/14.png",
        "https://ik.imagekit.io/q3d43lw6h/about/25.png",
        "https://ik.imagekit.io/q3d43lw6h/about/28.png",
        "https://ik.imagekit.io/q3d43lw6h/about/27.png",
        "https://ik.imagekit.io/q3d43lw6h/about/20.png",
        "https://ik.imagekit.io/q3d43lw6h/about/18.png",
        "https://ik.imagekit.io/q3d43lw6h/about/22.png",
        "https://ik.imagekit.io/q3d43lw6h/about/15.png",
        "https://ik.imagekit.io/q3d43lw6h/about/17.png",
        "https://ik.imagekit.io/q3d43lw6h/about/07.png",
        "https://ik.imagekit.io/q3d43lw6h/about/10.png",
        "https://ik.imagekit.io/q3d43lw6h/about/10.png",
        "https://ik.imagekit.io/q3d43lw6h/about/02.png",
        "https://ik.imagekit.io/q3d43lw6h/about/21.png",
        "https://ik.imagekit.io/q3d43lw6h/about/09.png",
        "https://ik.imagekit.io/q3d43lw6h/about/11.png",
        "https://ik.imagekit.io/q3d43lw6h/about/08.png",
        "https://ik.imagekit.io/q3d43lw6h/about/04.png",
        "https://ik.imagekit.io/q3d43lw6h/about/06.png",
        "https://ik.imagekit.io/q3d43lw6h/about/03.png",
        "https://ik.imagekit.io/q3d43lw6h/about/01.png"
      ];

      const tileSize = 60;
      const maxTiles = 333;
      const mainRange = tileSize * 3 * 0.8;
      const partialCount = 23;
      const fadeDuration = 500;

      let imgs = [];
      let imgsGray = [];
      let tiles = [];
      let loadedCount = 0;

      const trailColors = [
        [128, 128, 128],
        [0, 0, 0],
        [Math.random()*255, Math.random()*255, Math.random()*255]
      ];

      fileNames.forEach((url, idx) => {
        p.loadImage(url, img => {
          imgs[idx] = img;
          let g = img.get();
          g.filter(p.GRAY);
          imgsGray[idx] = g;
          loadedCount++;
          if (loadedCount === fileNames.length) generateTiles();
        });
      });

      function drawImageCover(img, w, h, alpha = 255) {
        const ratio = img.width / img.height;
        const boxRatio = w / h;
        let drawW = w, drawH = h;

        if (ratio > boxRatio) {
          drawW = ratio * h;
        } else {
          drawH = w / ratio;
        }

        p.tint(255, alpha);
        p.image(img, -drawW / 2, -drawH / 2, drawW, drawH);
        p.noTint();
      }

      function generateTiles() {
        tiles = [];
        for (let i = 0; i < maxTiles; i++) {
          const imgIndex = Math.floor(p.random(imgs.length));
          tiles.push({
            x: p.random(tileSize / 2, p.width - tileSize / 2),
            y: p.random(tileSize / 2, p.height - tileSize / 2),
            imgIndex,
            imgColor: imgs[imgIndex],
            imgGray: imgsGray[imgIndex],
            rot: 0,
            scale: 1,
            alpha: 0,
            targetAlpha: 0,
            targetScale: 1,
            targetRot: 0,
            trailColor: trailColors[Math.floor(p.random(trailColors.length))],
            shuffleTimer: 0,
            shuffleInterval: p.random(80, 160)
          });
        }
      }

      p.setup = () => {
        p.createCanvas(p.windowWidth, p.windowHeight).parent("p5-holder");
      };

      p.windowResized = () => {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        if (loadedCount === fileNames.length) generateTiles();
      };

      p.draw = () => {
        if (loadedCount < fileNames.length) return;

        p.background(0);

        const distances = tiles.map((t, i) => ({
          index: i,
          dist: p.dist(p.mouseX, p.mouseY, t.x, t.y)
        })).sort((a, b) => a.dist - b.dist);

        const partialIndexes = distances
          .filter(d => d.dist > mainRange)
          .slice(0, partialCount)
          .map(d => d.index);

        tiles.forEach((t, i) => {
          const d = p.dist(p.mouseX, p.mouseY, t.x, t.y);
          const isMain = d < mainRange;
          const isPartial = partialIndexes.includes(i);

          t.targetScale = isMain ? 1.75 : isPartial ? 1.1 : 1;
          t.targetAlpha = isMain ? 255 : isPartial ? 50 : 0;
          t.targetRot = isMain ? p.random(-0.1, 0.1) : isPartial ? p.random(-0.05, 0.05) : 0;

          t.alpha = p.lerp(t.alpha, t.targetAlpha, p.deltaTime / (fadeDuration * 0.7));
          t.scale = p.lerp(t.scale, t.targetScale, 0.08);
          t.rot = p.lerp(t.rot, t.targetRot, 0.08);

          if (t.alpha > 1) {
            p.push();
            p.translate(t.x, t.y);
            p.rotate(t.rot);
            p.scale(t.scale);
            p.imageMode(p.CENTER);

            drawImageCover(isMain ? t.imgColor : t.imgGray, tileSize, tileSize, t.alpha);

            const c = t.trailColor;
            p.noStroke();
            p.fill(c[0], c[1], c[2], t.alpha * 0.2);
            p.rectMode(p.CENTER);
            p.rect(0, 0, tileSize, tileSize);

            p.pop();
          }
        });
      };
    });
  </script>
</body>
</html>
